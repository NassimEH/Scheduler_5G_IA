groups:
  - name: scheduler_comparison
    interval: 15s
    rules:
      # Métriques avec label scheduler_type=default (données réelles)
      - record: node_cpu_usage_ratio:default
        expr: 100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)
        labels:
          scheduler_type: "default"
      
      - record: node_memory_usage_ratio:default
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100
        labels:
          scheduler_type: "default"
      
      # Métriques avec label scheduler_type=ml (simulation avec amélioration)
      - record: node_cpu_usage_ratio:ml
        expr: (100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)) * 0.85
        labels:
          scheduler_type: "ml"
      
      - record: node_memory_usage_ratio:ml
        expr: ((1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100) * 0.90
        labels:
          scheduler_type: "ml"
      
      # Déséquilibre CPU
      - record: cpu_load_balance:default
        expr: stddev(100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100))
        labels:
          scheduler_type: "default"
      
      - record: cpu_load_balance:ml
        expr: stddev(100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)) * 0.85
        labels:
          scheduler_type: "ml"
      
      # Déséquilibre mémoire
      - record: memory_load_balance:default
        expr: stddev((1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100)
        labels:
          scheduler_type: "default"
      
      - record: memory_load_balance:ml
        expr: stddev((1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100) * 0.90
        labels:
          scheduler_type: "ml"

